<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crypto Bot Dashboard</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #1e1e2f;
    color: #f0f0f0;
    padding: 20px;
  }
  h1 { text-align: center; color: #ffcc00; }
  #tableContainer {
    max-height: 500px;
    overflow-y: auto;
    margin-top: 20px;
    border: 1px solid #444;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    border: 1px solid #444;
    text-align: center;
    font-size: 14px;
  }
  th { background-color: #222; position: sticky; top: 0; z-index: 1; }
  tr:nth-child(even) { background-color: #2a2a3d; }
  .BUY { background-color: #0f6; color: #000; font-weight: bold; }
  .SELL { background-color: #f33; color: #fff; font-weight: bold; }
  .PAPER { background-color: #66f; color: #fff; font-weight: bold; }
  .LIVE { background-color: #ff0; color: #000; font-weight: bold; }
</style>
</head>
<body>
<h1>Crypto Bot Dashboard</h1>

<div id="tableContainer">
  <table id="dashboardTable">
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Timeframe</th>
        <th>Signal</th>
        <th>Mode</th>
        <th>Price</th>
        <th>Timestamp</th>
      </tr>
    </thead>
    <tbody>
      <tr><td colspan="6">Načítám data...</td></tr>
    </tbody>
  </table>
</div>

<script>
const JSON_URL = 'status.json';

async function loadData() {
  try {
    const res = await fetch(JSON_URL + '?t=' + Date.now());
    if (!res.ok) throw new Error('Chyba při načítání JSON');
    const data = await res.json();

    const tbody = document.querySelector('#dashboardTable tbody');

    // pokud data.activeTrades je pole objektů, iterujeme přes všechny
    data.activeTrades.forEach(trade => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${trade.symbol}</td>
        <td>${trade.tf}</td>
        <td class="${trade.side}">${trade.side}</td>
        <td class="${trade.mode || 'PAPER'}">${trade.mode || 'PAPER'}</td>
        <td>${trade.price.toFixed(2)}</td>
        <td>${new Date(trade.time).toLocaleTimeString()}</td>
      `;
      tbody.appendChild(row);
    });

    // scroll dolů na poslední řádek
    const container = document.getElementById('tableContainer');
    container.scrollTop = container.scrollHeight;

  } catch (err) {
    console.error(err);
    const tbody = document.querySelector('#dashboardTable tbody');
    tbody.innerHTML = `<tr><td colspan="6">Chyba při načítání dat</td></tr>`;
  }
}

// inicialní načtení
loadData();

// aktualizace každých 3 sekund
setInterval(loadData, 3000);
</script>
</body>
</html>